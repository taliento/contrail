<div class="jumbotron">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1 class="display-4">Contrail <span>
          <i class="fa fa-plane" aria-hidden="true"></i>
        </span></h1>
        <p class="lead" i18n>Compare cheap Flights.</p>
      </div>
    </div>
    <hr class="my-4">
    <div class="row">
      <div class="col-md-12">
        <form [formGroup]="profileForm" (ngSubmit)="createSession()">
          <fieldset [disabled]="loading">
            <div class="form-row">
              <div class="col-md-6 form-group row">
                <label for="originPlace" class="col-sm-2 col-form-label" i18n>From</label>
                <div class="col-sm-8">
                  <input id="originPlace" type="text" class="form-control"
                [inputFormatter]="formatter" [class.is-invalid]="searchFailed"
                formControlName="originPlace" [ngbTypeahead]="searchOriginPlace"
                placeholder="Origin place search" [resultTemplate]="rt" required/>
                  <div class="invalid-feedback" *ngIf="searchFailed">
                    <span i18n>Sorry, suggestions could not be loaded.</span>
                  </div>
                  <div *ngIf="originPlace.invalid && !searchFailed" class="invalid-feedback">
                    <span i18n>Please choose a location.</span>
                  </div>
                  <div *ngIf="originPlace.valid" class="valid-feedback">
                    <span i18n>Looks great!</span>
                  </div>
                </div>
                <div class="col-sm-2">
                  <span *ngIf="searching">
                    <i class='fa fa-spinner fa-spin'></i>
                  </span>
                </div>
              </div>
              <div class="col-auto">
                <button type="button" class="btn btn-outline-primary" (click)="switchPlace()">
                <span><i class="fa fa-arrows-alt-h"></i></span>
              </button>
              </div>
              <div class="col-md-6 form-group row">
                <label for="destinationPlace" class="col-sm-2 col-form-label" i18n>To</label>
                <div class="col-sm-8">
                  <input id="destinationPlace" type="text" class="form-control" [inputFormatter]="formatter" [class.is-invalid]="searchDestinationFailed" formControlName="destinationPlace" [ngbTypeahead]="searchDestinationPlace" placeholder="Destination place search" [resultTemplate]="rt" required/>
                  <div class="invalid-feedback" *ngIf="searchDestinationFailed"><span i18n>Sorry, suggestions could not be loaded.</span></div>
                  <div *ngIf="destinationPlace.invalid && !searchDestinationFailed" class="invalid-feedback">
                    <span i18n>Please choose a location.</span>
                  </div>
                  <div *ngIf="destinationPlace.valid" class="valid-feedback">
                    <span i18n>Looks great!</span>
                  </div>
                </div>
                <div class="col-sm-2">
                  <span *ngIf="searchingDestination">
                    <i class='fa fa-spinner fa-spin'></i>
                  </span>
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="col-md-6 form-group row">
                <label for="outboundDate" class="col-sm-2 col-form-label" i18n>Depart</label>
                <div class="col-sm-10">
                  <div class="input-group">
                    <input id="outboundDate" class="form-control" placeholder="yyyy-mm-dd"
                        formControlName="outboundDate" ngbDatepicker #outboundDatePicker="ngbDatepicker" required>
                    <div class="input-group-append">
                      <button class="btn btn-outline-secondary" (click)="outboundDatePicker.toggle()" type="button"><i class="fa fa-calendar" aria-hidden="true"></i></button>
                    </div>
                  </div>
                  <div *ngIf="outboundDate.invalid" class="invalid-feedback">
                    <span i18n>Please choose a Date.</span>
                  </div>
                  <div *ngIf="outboundDate.valid" class="valid-feedback">
                    <span i18n>Looks great!</span>
                  </div>
                </div>
              </div>
              <div class="col-auto">
                <button type="button" class="btn btn-outline-primary" (click)="switchDate()"><span><i class="fa fa-arrows-alt-h"></i></span></button>
              </div>
              <div class="col-md-6 form-group row">
                <label for="inboundDate" class="col-sm-2 col-form-label" i18n>Return</label>
                <div class="col-sm-10">
                  <div class="input-group">
                    <input id="inboundDate" class="form-control" placeholder="yyyy-mm-dd"
                         formControlName="inboundDate" ngbDatepicker #inboundDatePicker="ngbDatepicker" required>
                    <div class="input-group-append">
                      <button class="btn btn-outline-secondary" (click)="inboundDatePicker.toggle()" type="button"><i class="fa fa-calendar" aria-hidden="true"></i></button>
                    </div>
                  </div>
                  <div *ngIf="inboundDate.invalid" class="invalid-feedback">
                    <span i18n>Please choose a Date.</span>
                  </div>
                  <div *ngIf="inboundDate.valid" class="valid-feedback">
                    <span i18n>Looks great!</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="col-md-4 form-group">
                <label for="adults" class="col-form-label" i18n>Adults</label>
                <input id="adults" type="number" class="form-control" formControlName="adults" required >
                <div *ngIf="adults.invalid" class="invalid-feedback">
                  <span i18n>Number of adults (16+ years). Must be between 1 and 8.</span>
                </div>
                <div *ngIf="adults.valid" class="valid-feedback">
                  <span i18n>Looks great!</span>
                </div>
              </div>
              <div class="col-md-4 form-group">
                <label for="children" class="col-form-label" i18n>Children</label>
                <input id="children" type="number" class="form-control" formControlName="children">
                <div *ngIf="children.invalid" class="invalid-feedback">
                  <span i18n>Check conditions.</span>
                </div>
                <div *ngIf="children.valid" class="valid-feedback">
                  <span i18n>Looks great!</span>
                </div>
              </div>
              <div class="col-md-4 form-group">
                <label for="cabinClass" class="col-form-label" i18n>Cabin class</label>
                <select id="cabinClass" class="form-control" formControlName="cabinClass" required>
                <option [value]="'economy'">Economy</option>
                <option [value]="'premiumeconomy'">Premium economy</option>
                <option [value]="'business'">Business</option>
                <option [value]="'first'">First</option>
              </select>
                <div *ngIf="cabinClass.invalid" class="invalid-feedback">
                  <span i18n>Choose one</span>
                </div>
                <div *ngIf="cabinClass.valid" class="valid-feedback">
                  <span i18n>Looks great!</span>
                </div>
              </div>
            </div>
          </fieldset>
          <button type="submit" [disabled]="profileForm.errors?.samePlace || !profileForm.valid || loading" name="createSession" class="btn btn-primary">
            <span *ngIf="loading" i18n> Search
              <i class='fa fa-spinner fa-spin'></i>
            </span>
            <span *ngIf="!loading" i18n>Search</span>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<ng-template #rt let-r="result" let-t="term">
  <span><i class="fa" [ngClass]="{'fa-city': r.PlaceId == r.CityId, 'fa-plane': r.PlaceId != r.CityId}"></i>&nbsp;</span>
  <ngb-highlight [result]="r.PlaceName + ' - ' + r.CountryName" [term]="t"></ngb-highlight>
</ng-template>
